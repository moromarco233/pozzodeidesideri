<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Pozzo dei Desideri / The Wishing Well</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <style>
    /* RESET & BASE */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Georgia', serif;
      background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
      color: #f7f1e3;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }
    
    /* SFONDO STELLATO */
    .stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAwIiBoZWlnaHQ9IjUwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSIxIiBmaWxsPSJ3aGl0ZSIgb3BhY2l0eT0iMC43Ii8+PC9zdmc+') repeat;
      z-index: -1;
      animation: twinkle 5s infinite alternate;
    }
    
    @keyframes twinkle {
      0% { opacity: 0.3; }
      100% { opacity: 0.8; }
    }
    
    /* CONTAINER PRINCIPALE */
    .container {
      max-width: 600px;
      width: 100%;
      background: rgba(25, 42, 86, 0.85);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px 30px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    /* HEADER E TITOLI */
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: #fad390;
      text-shadow: 0 0 15px rgba(250, 211, 144, 0.5);
      letter-spacing: 1px;
    }
    
    .subtitle {
      font-size: 1.2rem;
      color: #82ccdd;
      margin-bottom: 40px;
      font-style: italic;
      line-height: 1.5;
    }
    
    /* STEP 1: IL POZZO VISIVO */
    .well-visual {
      width: 200px;
      height: 180px;
      margin: 30px auto;
      position: relative;
    }
    
    .well-body {
      width: 150px;
      height: 150px;
      background: radial-gradient(circle at 30% 30%, #4a2c2a, #2c1810);
      margin: 0 auto;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 0 20px rgba(0,0,0,0.8), 0 10px 20px rgba(0,0,0,0.6);
    }
    
    .water {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 60%;
      background: radial-gradient(ellipse at center, rgba(72, 147, 227, 0.7) 0%, rgba(25, 75, 124, 0.9) 100%);
      border-top: 2px solid rgba(100, 181, 246, 0.5);
    }
    
    .ripple {
      position: absolute;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.7);
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0;
    }
    
    /* FORM DEL DESIDERIO */
    .wish-input {
      width: 100%;
      min-height: 120px;
      padding: 15px;
      font-size: 1.1rem;
      font-family: 'Georgia', serif;
      background: rgba(15, 23, 42, 0.9);
      border: 2px solid #5d4a2e;
      border-radius: 12px;
      color: #f0e6d2;
      resize: vertical;
      margin-bottom: 15px;
      line-height: 1.6;
    }
    
    .wish-input::placeholder {
      color: #b8a07e;
      font-style: italic;
    }
    
    /* BOTTONE MONETA */
    .coin-button {
      position: relative;
      padding: 16px 40px;
      font-size: 1.2rem;
      font-weight: bold;
      background: radial-gradient(circle at 30% 30%, #f6b93b, #e58e26);
      color: #2d3436;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      margin: 20px auto;
      display: block;
      box-shadow: 0 8px 0 #b9770e, 0 15px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.2s ease;
      font-family: 'Georgia', serif;
      letter-spacing: 1px;
    }
    
    .coin-button:hover {
      transform: translateY(2px);
      box-shadow: 0 6px 0 #b9770e, 0 10px 15px rgba(0, 0, 0, 0.3);
      background: radial-gradient(circle at 30% 30%, #fad390, #f6b93b);
    }
    
    .coin-button:active {
      transform: translateY(6px);
      box-shadow: 0 2px 0 #b9770e, 0 5px 10px rgba(0, 0, 0, 0.2);
    }
    
    /* STEP 2: MESSAGGIO DI CONFERMA */
    .confirmation {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 30px;
      margin-top: 30px;
      display: none;
      border-left: 5px solid #78e08f;
      animation: fadeIn 0.8s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .confirmation h2 {
      color: #78e08f;
      margin-bottom: 15px;
      font-size: 1.8rem;
    }
    
    /* STEP 3: OFFERTA OPZIONALE (la tua form originale) */
    .offer-section {
      display: none;
      margin-top: 40px;
      padding-top: 30px;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      animation: fadeIn 1s ease-out;
    }
    
    .email-input {
      width: 70%;
      padding: 14px 20px;
      font-size: 1.1rem;
      border: 2px solid #82ccdd;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      margin: 20px 0;
    }
    
    .secondary-button {
      padding: 14px 30px;
      font-size: 1rem;
      background: #82ccdd;
      color: #1e272e;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin: 10px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    
    .secondary-button:hover {
      background: #60a3bc;
      transform: scale(1.05);
    }
    
    .text-button {
      background: none;
      border: none;
      color: #82ccdd;
      cursor: pointer;
      text-decoration: underline;
      font-size: 0.9rem;
      margin-top: 15px;
      display: block;
    }
    
    /* UTILITY */
    .hidden {
      display: none;
    }
    
    .fade-out {
      animation: fadeOut 0.8s ease-out forwards;
    }
    
    @keyframes fadeOut {
      to { opacity: 0; transform: translateY(-20px); }
    }
    
    /* STELLA CADENTE */
    .falling-star {
      position: fixed;
      width: 3px;
      height: 3px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 0 10px white;
      opacity: 0;
      z-index: 1000;
    }
    
    /* RESPONSIVE */
    @media (max-width: 600px) {
      .container {
        padding: 25px 20px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .wish-input {
        min-height: 100px;
      }
      
      .coin-button {
        padding: 14px 30px;
        font-size: 1.1rem;
      }
    }
  </style>
</head>
<body>
  <!-- SFONDO STELLATO -->
  <div class="stars"></div>
  
  <!-- CONTAINER PRINCIPALE -->
  <div class="container">
    
    <!-- HEADER CON LINGUA -->
    <div id="header-it" class="header-section">
      <h1>âœ¨ Pozzo dei Desideri âœ¨</h1>
      <p class="subtitle">Scrivi il tuo desiderio, gettalo nel pozzo, e lascia che l'universo ne senta l'eco...</p>
    </div>
    
    <div id="header-en" class="header-section hidden">
      <h1>âœ¨ The Wishing Well âœ¨</h1>
      <p class="subtitle">Write your wish, throw it into the well, and let the universe hear its echo...</p>
    </div>
    
    <!-- STEP 1: IL POZZO E IL FORM DEL DESIDERIO -->
    <div id="step1">
      <!-- Pozzo visivo -->
      <div class="well-visual">
        <div class="well-body">
          <div class="water" id="water">
            <div class="ripple" id="ripple"></div>
          </div>
        </div>
      </div>
      
      <!-- Testo del desiderio -->
      <textarea id="wishInput" class="wish-input" 
                placeholder="Scrivi qui il tuo desiderio piÃ¹ profondo... âœ¨"
                maxlength="500"></textarea>
      <div style="color: #b8a07e; margin-bottom: 20px;">
        <span id="charCount">0</span>/500 caratteri
      </div>
      
      <!-- Bottone per gettare -->
      <button id="throwButton" class="coin-button">
        ðŸª™ GETTA NEL POZZO
      </button>
      
      <p style="color: #82ccdd; font-size: 0.9rem; margin-top: 20px;">
        âœ¦ Il tuo desiderio Ã¨ anonimo e sacro âœ¦
      </p>
    </div>
    
    <!-- STEP 2: CONFERMA MAGICA -->
    <div id="step2" class="confirmation">
      <h2>âœ¨ Desiderio Affidato alle Acque! âœ¨</h2>
      <p id="confirmation-text">Il tuo desiderio si Ã¨ unito agli altri segreti custoditi nel pozzo.</p>
      <p style="margin-top: 15px; font-size: 1.1rem;">
        <em>"Ora chiudi gli occhi, fa' un respiro profondo e fidati del viaggio."</em>
      </p>
    </div>
    
    <!-- STEP 3: OFFERTA OPZIONALE (FORM EMAIL) -->
    <div id="step3" class="offer-section">
      <h3 style="color: #fad390; margin-bottom: 20px;">âœ¦ Vuoi custodire questo desiderio? âœ¦</h3>
      
      <p id="offer-text" style="margin-bottom: 25px; line-height: 1.6;">
        Possiamo inviarti una "stella cadente" via email tra 7 giorni per ricordartelo.<br>
        La tua email sarÃ  usata solo per questo.
      </p>
      
      <!-- FORM PER L'EMAIL (tua versione originale) -->
      <form method="POST" 
            action="https://script.google.com/macros/s/AKfycbw126YUNifMB95tjpfqAgzZrdI40-Ox6KswjyrGvjJkzYYRrnaqHk5mKJnCQG7kXYoW_A/exec"
            target="hiddenFrame"
            id="emailForm">
        
        <input type="email" name="email" class="email-input" 
               placeholder="la.tua@email.com" required>
        
        <!-- Campi nascosti per inviare anche il desiderio -->
        <input type="hidden" name="wish_text" id="hiddenWish">
        <input type="hidden" name="language" id="hiddenLang">
        <input type="hidden" name="action" value="register">
        
        <div style="margin-top: 25px;">
          <button type="submit" class="secondary-button">
            âœ¨ SÃ¬, custodiscilo per me
          </button>
          <button type="button" id="skipButton" class="text-button">
            No grazie, lascia che viaggi libero
          </button>
        </div>
      </form>
      
      <!-- Messaggio di ringraziamento dopo l'invio email -->
      <div id="thankYouMsg" style="display: none; margin-top: 30px; color: #78e08f;">
        <h3>âœ¨ Grazie! âœ¨</h3>
        <p>Riceverai la tua stella cadente tra 7 giorni.</p>
      </div>
    </div>
  </div>
  
  <!-- IFRAME NASCOSTO PER IL FORM -->
  <iframe name="hiddenFrame" style="display:none;"></iframe>
  
  <script>
    // DETECT LINGUA
    const userLang = navigator.language || navigator.userLanguage;
    const isItalian = userLang.toLowerCase().startsWith('it');
    
    // ELEMENTI DOM
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const wishInput = document.getElementById('wishInput');
    const throwButton = document.getElementById('throwButton');
    const confirmationText = document.getElementById('confirmation-text');
    const offerText = document.getElementById('offer-text');
    const headerIt = document.getElementById('header-it');
    const headerEn = document.getElementById('header-en');
    const hiddenWish = document.getElementById('hiddenWish');
    const hiddenLang = document.getElementById('hiddenLang');
    const emailForm = document.getElementById('emailForm');
    const thankYouMsg = document.getElementById('thankYouMsg');
    const skipButton = document.getElementById('skipButton');
    const water = document.getElementById('water');
    const ripple = document.getElementById('ripple');
    
    // TESTI IN BASE ALLA LINGUA
    const texts = {
      it: {
        placeholder: "Scrivi qui il tuo desiderio piÃ¹ profondo... âœ¨",
        button: "ðŸª™ GETTA NEL POZZO",
        privacy: "âœ¦ Il tuo desiderio Ã¨ anonimo e sacro âœ¦",
        confirmation: "Il tuo desiderio si Ã¨ unito agli altri segreti custoditi nel pozzo.",
        offer: "Possiamo inviarti una 'stella cadente' via email tra 7 giorni per ricordartelo.<br>La tua email sarÃ  usata solo per questo.",
        emailPlaceholder: "la.tua@email.com",
        yesButton: "âœ¨ SÃ¬, custodiscilo per me",
        noButton: "No grazie, lascia che viaggi libero",
        thankYou: "Riceverai la tua stella cadente tra 7 giorni."
      },
      en: {
        placeholder: "Write your deepest wish here... âœ¨",
        button: "ðŸª™ THROW INTO THE WELL",
        privacy: "âœ¦ Your wish is anonymous and sacred âœ¦",
        confirmation: "Your wish has joined the other secrets kept in the well.",
        offer: "We can send you a 'falling star' via email in 7 days to remind you.<br>Your email will only be used for this.",
        emailPlaceholder: "your@email.com",
        yesButton: "âœ¨ Yes, keep it for me",
        noButton: "No thanks, let it travel free",
        thankYou: "You will receive your falling star in 7 days."
      }
    };
    
    // IMPOSTA LINGUA
    const lang = isItalian ? 'it' : 'en';
    const t = texts[lang];
    
    // Applica testi
    wishInput.placeholder = t.placeholder;
    throwButton.textContent = t.button;
    document.querySelector('#step1 p').textContent = t.privacy;
    confirmationText.textContent = t.confirmation;
    offerText.innerHTML = t.offer;
    document.querySelector('.email-input').placeholder = t.emailPlaceholder;
    document.querySelector('.secondary-button').textContent = t.yesButton;
    document.querySelector('.text-button').textContent = t.noButton;
    
    // Mostra header corretto
    if (isItalian) {
      headerEn.classList.add('hidden');
    } else {
      headerIt.classList.add('hidden');
    }
    
    // CONTATORE CARATTERI
    const charCount = document.getElementById('charCount');
    wishInput.addEventListener('input', () => {
      charCount.textContent = wishInput.value.length;
    });
    
    // ANIMAZIONE GETTA NEL POZZO
    throwButton.addEventListener('click', () => {
      const wish = wishInput.value.trim();
      
      if (wish.length < 5) {
        alert(isItalian ? "Scrivi un desiderio di almeno 5 caratteri!" : "Write a wish of at least 5 characters!");
        return;
      }
      
      // Salva il desiderio per l'invio eventuale
      hiddenWish.value = wish;
      hiddenLang.value = lang;
      
      // 1. Nascondi step1 con animazione
      step1.classList.add('fade-out');
      
      // 2. Animazione dell'acqua
      ripple.style.animation = 'ripple-effect 1.5s ease-out';
      setTimeout(() => {
        ripple.style.animation = '';
      }, 1500);
      
      // 3. Suoni (simulati - sostituisci con URL reali)
      const coinSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-coin-handling-1999.mp3');
      const waterSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-water-splash-1250.mp3');
      
      setTimeout(() => coinSound.play().catch(e => console.log("Audio error:", e)), 200);
      setTimeout(() => waterSound.play().catch(e => console.log("Audio error:", e)), 800);
      
      // 4. Mostra step2 dopo l'animazione
      setTimeout(() => {
        step1.style.display = 'none';
        step2.style.display = 'block';
        
        // 5. Crea una stella cadente
        createFallingStar();
        
        // 6. Dopo 4 secondi, mostra l'offerta (step3)
        setTimeout(() => {
          step2.classList.add('fade-out');
          setTimeout(() => {
            step2.style.display = 'none';
            step3.style.display = 'block';
          }, 800);
        }, 4000);
        
      }, 800);
    });
    
    // STELLA CADENTE
    function createFallingStar() {
      const star = document.createElement('div');
      star.className = 'falling-star';
      star.style.left = Math.random() * 100 + 'vw';
      star.style.top = '-10px';
      document.body.appendChild(star);
      
      // Animazione
      star.animate([
        { opacity: 0, transform: 'translateY(0) translateX(0)' },
        { opacity: 1, transform: 'translateY(0) translateX(0)' },
        { opacity: 1, transform: `translateY(${window.innerHeight + 100}px) translateX(${Math.random() * 200 - 100}px)` }
      ], {
        duration: 2000,
        easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)'
      });
      
      setTimeout(() => star.remove(), 2000);
    }
    
    // ANIMAZIONE RIPPLE (CSS)
    const style = document.createElement('style');
    style.textContent = `
      @keyframes ripple-effect {
        0% { transform: translate(-50%, -50%) scale(0.1); opacity: 1; }
        100% { transform: translate(-50%, -50%) scale(4); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
    
    // GESTIONE FORM EMAIL
    emailForm.addEventListener('submit', function(e) {
      // Invia al Google Apps Script (funziona come prima)
      setTimeout(() => {
        // Nascondi il form e mostra ringraziamento
        emailForm.style.display = 'none';
        thankYouMsg.style.display = 'block';
        
        // Chiudi tutto dopo 3 secondi
        setTimeout(() => {
          document.querySelector('.container').classList.add('fade-out');
          setTimeout(() => {
            // Messaggio finale
            document.body.innerHTML = `
              <div style="text-align: center; padding: 50px; color: white;">
                <h1>${isItalian ? 'âœ¨ Grazie! âœ¨' : 'âœ¨ Thank You! âœ¨'}</h1>
                <p style="font-size: 1.2rem; margin-top: 20px;">
                  ${isItalian ? 
                    'Il tuo desiderio Ã¨ al sicuro.<br>Tornerai a ricevere notizie tra 7 giorni.' : 
                    'Your wish is safe.<br>You will hear back in 7 days.'}
                </p>
                <p style="margin-top: 30px; opacity: 0.7;">
                  <a href="/" style="color: #82ccdd;">
                    ${isItalian ? 'Torna al pozzo' : 'Back to the well'}
                  </a>
                </p>
              </div>
            `;
          }, 800);
        }, 3000);
      }, 100);
    });
    
    // PULSANTE "SALTA"
    skipButton.addEventListener('click', () => {
      // Invia comunque il desiderio come anonimo
      const formData = new FormData();
      formData.append('wish_text', hiddenWish.value);
      formData.append('language', lang);
      formData.append('action', 'anonymous');
      
      fetch(emailForm.action, {
        method: 'POST',
        body: new URLSearchParams(formData),
        mode: 'no-cors'
      });
      
      // Chiudi con messaggio finale
      document.querySelector('.container').classList.add('fade-out');
      setTimeout(() => {
        document.body.innerHTML = `
          <div style="text-align: center; padding: 50px; color: white;">
            <h1>${isItalian ? 'âœ¨ Grazie! âœ¨' : 'âœ¨ Thank You! âœ¨'}</h1>
            <p style="font-size: 1.2rem; margin-top: 20px;">
              ${isItalian ? 
                'Il tuo desiderio viaggia libero nell\'universo.' : 
                'Your wish travels free in the universe.'}
            </p>
            <p style="margin-top: 30px; opacity: 0.7;">
              <a href="/" style="color: #82ccdd;">
                ${isItalian ? 'Torna al pozzo' : 'Back to the well'}
              </a>
            </p>
          </div>
        `;
      }, 800);
    });
  </script>
</body>
</html>